BASE = ../..

.PHONY: atax

all: atax

#
# ATAX
#

FATAX = -D$(SIZE) -I$(BASE)/utilities -I$(BASE)/linear-algebra/kernels/atax

atax: atax_base atax_time atax_ref atax_papi

atax_base: polybench.o atax_base.o
	kernelgen $^ -o $@

atax_time: polybench.o atax_time.o
	kernelgen $^ -o $@

atax_ref: polybench.o atax_ref.o
	kernelgen $^ -o $@

atax_papi: polybench.o atax_papi.o
	kernelgen $^ -o $@ -lpapi

atax_base.o: $(BASE)/linear-algebra/kernels/atax/atax.c
	kernelgen $(FATAX) -c $< -o $@

atax_time.o: $(BASE)/linear-algebra/kernels/atax/atax.c
	kernelgen -DPOLYBENCH_TIME $(FATAX) -c $< -o $@

atax_ref.o: $(BASE)/linear-algebra/kernels/atax/atax.c
	kernelgen -O0 -DPOLYBENCH_DUMP_ARRAYS $(FATAX) -c $< -o $@

atax_papi.o: $(BASE)/linear-algebra/kernels/atax/atax.c
	kernelgen -O3 -DPOLYBENCH_PAPI $(FATAX) -c $< -o $@ -lpapi

polybench.o: $(BASE)/utilities/polybench.c
	kernelgen -c $< -o $@

clean:
	rm -rf *.o atax_*

